/**
 * devcast.co - App for devcast
 * @version v1.0.0
 * @link    http://tapquo.com
 * @author   ()
 * @license MIT
 */
(function(){"use strict";var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};__.Entity.Video=function(_super){function Video(){return Video.__super__.constructor.apply(this,arguments)}return __extends(Video,_super),Video.fields("id","title","description","image","embed","duration","author","language","tags","type","level","views","created_at"),Video.prototype.parse=function(){return{image:this.image,text:this.title,description:this.tags[0]||""}},Video}(Atoms.Class.Entity),Atoms.Atom.Thumbnail=function(_super){function Thumbnail(){return Thumbnail.__super__.constructor.apply(this,arguments)}return __extends(Thumbnail,_super),Thumbnail}(Atoms.Atom.Li),Atoms.Organism.Main=function(_super){function Main(){return Main.__super__.constructor.apply(this,arguments)}return __extends(Main,_super),Main.scaffold("assets/scaffold/main.json"),Main.prototype.page={index:0,search:0},Main.prototype.render=function(){return Main.__super__.render.apply(this,arguments),this.fetch()},Main.prototype.fetch=function(explore,channel){var background,context,parameters;return context=this.query?"search":"index",background=!0,(explore!==this.explore||channel!==this.channel)&&(this.explore=explore,this.channel=channel,this.page[context]=0,__.Entity.Video.destroyAll(),background=!1),isNaN(this.page[context])?void 0:(this.page[context]++,this.fetching=!0,parameters={page:this.page[context],query:this.query},null!=explore&&(parameters.explore=explore),null!=channel&&(parameters.channel=channel),__.proxy("GET",context,parameters,background).then(function(_this){return function(error,response){var video,_i,_len,_ref;if(0!==response.videos.length)for(_ref=response.videos,_i=0,_len=_ref.length;_len>_i;_i++)video=_ref[_i],__.Entity.Video.create(video);else _this.page[context]=void 0;return _this.fetching=!1}}(this)))},Main.prototype.onSearchChange=function(){var dispatcher,event,hierarchy;return event=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],console.log("onSearchChange",dispatcher.value())},Main.prototype.onSectionScroll=function(event){return Main.__super__.onSectionScroll.apply(this,arguments),event.percent>90&&!this.fetching?this.fetch(this.explore,this.channel):void 0},Main.prototype.onVideo=function(){var dispatcher,event,hierarchy;return event=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],__.Article.Video.show(event.entity)},Main}(Atoms.Organism.Article),new Atoms.Organism.Main,Atoms.Organism.Options=function(_super){function Options(){return Options.__super__.constructor.apply(this,arguments)}return __extends(Options,_super),Options.scaffold("assets/scaffold/options.json"),Options.prototype.onContext=function(){var event,hierarchy,link;return event=arguments[0],link=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],__.Article.Main.fetch(link.attributes.explore,link.attributes.channel),__.Article.Main.aside(this.attributes.id)},Options}(Atoms.Organism.Aside),new Atoms.Organism.Options,Atoms.Organism.Video=function(_super){function Video(){this.show=__bind(this.show,this),Video.__super__.constructor.apply(this,arguments),this.bind("hide",this.onHide)}return __extends(Video,_super),Video.scaffold("assets/scaffold/video.json"),Video.prototype.show=function(entity){var tag,_i,_len,_ref;for(this.entity=entity,this.el||this.render(),this.info.video.refresh({url:this.entity.embed}),this.info.field.title.el.html(this.entity.title),this.info.field.description.el.html(this.entity.description),this.info.field.tags.destroyChildren(),this.info.field.tags.appendChild("Atom.Label",{value:""+this.entity.duration+" minutes",style:"theme"}),this.info.field.tags.appendChild("Atom.Label",{value:""+this.entity.language,style:"accept"}),_ref=this.entity.tags,_i=0,_len=_ref.length;_len>_i;_i++)tag=_ref[_i],this.info.field.tags.appendChild("Atom.Label",{value:tag});return Atoms.Url.path("video/info")},Video.prototype.onHide=function(){return this.info.video.refresh({url:void 0})},Video}(Atoms.Organism.Article),new Atoms.Organism.Video,Atoms.$(function(){return console.log("------------------------------------------------------------"),console.log("Atoms v"+Atoms.version+" (Atoms.App v"+Atoms.App.version+")"),console.log("------------------------------------------------------------"),Atoms.Url.path("main/videos")}),__.key={host:"http://devcast.co/devcast/",appnima:"NTM2YTZlZWYxZWFkMTZjMzQzOWE1NzM3OkljbjRFRHdiQ252b0JkdXBxdThvdHpiV2phbVRpOG8="},Atoms.Organism.Section.available.push("Atom.Iframe"),__.proxy=function(type,method,parameters,background){var promise,token;return null==parameters&&(parameters={}),null==background&&(background=!1),promise=new Hope.Promise,background||__.Modal.Loading.show(),token="undefined"!=typeof session&&null!==session?session.token:null,$$.ajax({url:""+__.key.host+method,type:type,data:parameters,contentType:"application/x-www-form-urlencoded",dataType:"json",headers:{Authorization:token},success:function(response){return background||__.Modal.Loading.hide(),promise.done(null,response)},error:function(){return function(xhr,error){return background||__.Modal.Loading.hide(),error={code:error.status,message:error.response},console.error("__.proxy [ERROR "+error.code+"]: "+error.message),promise.done(error,null)}}(this)}),promise}}).call(this);